import React, { useState, useMemo, useEffect } from 'react';
import { Calendar, ChevronLeft, ChevronRight, Search, Filter, Download, Info, CheckCircle, Users, Zap, BookOpen, Smile, Shield, Activity, Sun, CloudSnow, CloudRain, Leaf, Video, MessageCircle, Heart, Share2, Target, Copy } from 'lucide-react';

// --- DATA GENERATION LOGIC ---

const TOPICS = [
  "Relatable Meme",
  "Educational Post",
  "Community Engagement",
  "Current Event (Roofing)",
  "GAF Materials FAQ (Flat)",
  "Owens Corning FAQ (Asphalt)",
  "GAF Trivia (Flat)",
  "Owens Corning Trivia (Asphalt)",
  "RHIVE FAQ"
];

const DISC_TYPES = {
  D: { label: "Dominance", color: "bg-red-100 text-red-800", icon: Zap, desc: "Direct, results-oriented. Focus on speed & bottom line." },
  I: { label: "Influence", color: "bg-yellow-100 text-yellow-800", icon: Smile, desc: "Social, enthusiastic. Focus on fun, memes, & community." },
  S: { label: "Steadiness", color: "bg-green-100 text-green-800", icon: Users, desc: "Supportive, stable. Focus on trust, safety, & guarantees." },
  C: { label: "Conscientiousness", color: "bg-blue-100 text-blue-800", icon: BookOpen, desc: "Analytical, precise. Focus on specs, data, & details." }
};

const SEASONS = {
  Winter: { months: [11, 0, 1, 2], icon: CloudSnow, themes: ["Ice Dams", "Snow Load", "Emergency Leaks", "Insulation"] },
  Spring: { months: [3, 4, 5], icon: CloudRain, themes: ["Rain Prep", "Gutter Cleaning", "Spring Inspection", "Moss/Algae"] },
  Summer: { months: [6, 7, 8], icon: Sun, themes: ["UV Protection", "Attic Ventilation", "Heat Resistance", "Monsoon Storms"] },
  Fall: { months: [9, 10], icon: Leaf, themes: ["Winter Prep", "Leaf Removal", "Sealant Check", "Roof Age Check"] }
};

// Engagement Strategy Data
const ENGAGEMENT_STRATEGY = {
  dailyRoutine: [
    { count: 10, action: "Likes", target: "Local Realtors & Businesses", icon: Heart, color: "text-[#EC028B]" },
    { count: 5, action: "Comments", target: "Potential Partners (Designers/Architects)", icon: MessageCircle, color: "text-blue-500" },
    { count: 3, action: "Story Replies", target: "Local Influencers/Community Pages", icon: Share2, color: "text-purple-500" }
  ],
  targetAccounts: [
    {
      category: "Realtors (Referral Partners)",
      description: "Agents in SLC, Draper, Sandy, etc.",
      examples: ["@slc_realestate", "@utahrealestate", "Local brokerages (KW, Remax)"],
      goal: "Stay top of mind for inspections & replacements."
    },
    {
      category: "Property Managers / HOAs",
      description: "Commercial & Multi-family focus.",
      examples: ["@utahpropertymanagement", "Local HOA community pages"],
      goal: "Commercial flat roof contracts (GAF)."
    },
    {
      category: "Interior Designers / Flippers",
      description: "Home renovation pros in Utah.",
      examples: ["@utahhomebuilders", "Local renovation influencers"],
      goal: "Partner on full home remodels."
    },
    {
      category: "Local Community",
      description: "Utah lifestyle and news.",
      examples: ["@visitsaltlake", "@utahgram", "Local coffee shops/breweries"],
      goal: "Brand visibility and 'Local Expert' status."
    }
  ],
  commentBank: [
    {
      label: "Congratulating a Realtor (Sold House)",
      text: "Congrats on the closing! ðŸ¥‚ If the new owners need a peace-of-mind roof inspection, we're here to help!",
      tone: "Professional (D/S)"
    },
    {
      label: "Comment on Home Renovation (Design)",
      text: "Love this transformation! The curb appeal is huge. ðŸ˜",
      tone: "Supportive (I)"
    },
    {
      label: "Comment on Utah Weather/Scenery",
      text: "Nothing beats these Wasatch views! ðŸ”ï¸ Hope everyone is staying warm/cool today.",
      tone: "Community (I/S)"
    },
    {
      label: "Supportive Local Biz Comment",
      text: "Love seeing local businesses thrive in the valley! ðŸ™Œ #UtahBusiness",
      tone: "Supportive (S)"
    },
    {
      label: "Expert Tip (Gentle)",
      text: "Great shot! Just a heads up, with this snow load coming, keep an eye on those eaves for ice dams. Stay safe!",
      tone: "Helpful/Expert (C)"
    }
  ]
};

// Content Templates based on RHIVE Documents
const CONTENT_LIBRARY = {
  "Relatable Meme": [
    { 
      text: "When you realize the leak wasn't 'just a spill'. ðŸ˜… #RoofingLife", 
      disc: "I",
      creative: "Reel: Use the 'Oh No' sound. Show a homeowner calmly sitting on the couch, then pan up to a bucket of water catching drips. Cut to them frantically calling RHIVE."
    },
    { 
      text: "POV: You thought you could DIY your roof replacement. ðŸ› ï¸ðŸš« #CallThePros", 
      disc: "I",
      creative: "Reel: 'Expectation vs Reality'. Show a pro nailing shingles perfectly (fast motion), then cut to you tangled in a ladder or dropping a hammer (comedic/safe)."
    },
    { 
      text: "That feeling when the inspector says 'Passed with flying colors'. ðŸŽ‰", 
      disc: "I",
      creative: "Reel: Trending dance audio. Team member dancing on the ground in front of a finished house holding a 'PASSED' clipboard."
    },
    { 
      text: "Utah weather: 80 degrees one day, snow the next. Is your roof ready? ðŸ”ï¸", 
      disc: "I",
      creative: "Reel: Quick transition (snap fingers). Scene 1: Wearing shorts/sunglasses looking at roof. Scene 2: Wearing full parka/snow goggles in same spot."
    },
    { 
      text: "Me watching my neighbors clean their own gutters while I called RHIVE. â˜•", 
      disc: "I",
      creative: "Reel: Sip tea/coffee comfortably inside looking out a window. Text overlay pointing outside: 'Neighbors struggling'. Text overlay on you: 'Me who booked RHIVE'."
    },
    { 
      text: "Roofers on a steep pitch be like... ðŸ§—â€â™‚ï¸ #SafetyFirst", 
      disc: "I",
      creative: "Reel: Mission Impossible theme. Show roofer harnessed up, checking gear theatrically like they are about to skydive, then just calmly stepping onto the roof ladder."
    }
  ],
  "Educational Post": [
    { 
      text: "Did you know proper ventilation can lower your AC bill? Here's how.", 
      disc: "C",
      creative: "Reel: Green Screen. Background: Diagram of airflow in an attic (intake vs exhaust). Speaker pointing to where hot air gets trapped. Text: 'Save $$ on AC'."
    },
    { 
      text: "The difference between 'Overlay' vs 'Tear-off'. Why we recommend tear-off.", 
      disc: "S",
      creative: "Reel: Visual Metaphor. Trying to wear 2 winter coats at once (bulky, uncomfortable) vs wearing one good coat. Explain that roofs are the sameâ€”don't layer them!"
    },
    { 
      text: "What are 'Ice Dams'? Why they happen in Utah and how to stop them.", 
      disc: "S",
      creative: "Reel: Whiteboard Session. Draw a quick sketch of a roof edge. Use a blue marker to show ice buildup pushing water BACK under the shingles. Fast motion drawing."
    },
    { 
      text: "Signs your asphalt shingles are nearing end-of-life: Granule loss explained.", 
      disc: "C",
      creative: "Reel: Extreme Close-Up. Show granules in a gutter splash block. Pick them up with hand. Cut to bald spots on a shingle. Voiceover explaining the connection."
    },
    { 
      text: "Why we check your attic insulation during a roof inspection.", 
      disc: "S",
      creative: "Reel: POV Flashlight tour. Walking into a dark attic, shining light on low insulation. Text overlay: 'Your roof protects the house, this protects your wallet'."
    },
    { 
      text: "Understanding Roof Pitch: Why it matters for material selection.", 
      disc: "C",
      creative: "Reel: Hand angles. Show hand flat (low slope) = 'Needs membrane'. Tilt hand steep = 'Needs shingles'. Tilt vertical = 'Needs wall cladding'. Simple visual cues."
    }
  ],
  "Community Engagement": [
    { 
      text: "Spotlight on our Woman-Owned leadership! ðŸ’ª #WomenInConstruction", 
      disc: "I",
      creative: "Reel: 'Day in the Life'. Fast cuts of female leadership at RHIVEâ€”reviewing plans, on site with hard hat, shaking hands. High energy, empowering audio."
    },
    { 
      text: "We love Utah! What's your favorite local hiking trail? ðŸŒ²", 
      disc: "I",
      creative: "Reel: Drone/Scenic shots. Montage of beautiful Utah mountains/roofs with mountains in background. Ask question in text overlay: 'Best hike in the valley?'"
    },
    { 
      text: "Safety isn't just a checkbox, it's our promise. Keeping our crew and your property safe every single day. ðŸ›¡ï¸ #SafetyFirst", 
      disc: "S",
      creative: "Reel: Safety Gear ASMR. Close ups of buckling harnesses, adjusting hard hats, setting up ladder stabilizers. Text overlay: 'We take safety seriously so you don't have to worry'."
    },
    { 
      text: "Show us your 'Ugly Roof' photos! Winner gets a free inspection & gift card.", 
      disc: "I",
      creative: "Reel: 'Roast this Roof'. Show a stock photo of a terrible roof. Make a funny face. Point to camera: 'Is yours worse? Send us a pic!'"
    },
    { 
      text: "Celebrating Pioneer Day! How are you spending the holiday? ðŸŽ†", 
      disc: "I",
      creative: "Reel: Fireworks/Parade clips mixed with RHIVE trucks driving in the parade (if applicable) or team having a BBQ. Celebration audio."
    },
    { 
      text: "Teacher Appreciation Week: We appreciate all the educators in our Utah community! ðŸŽ #ThankYouTeachers", 
      disc: "S",
      creative: "Reel: Team Shoutout. Montage of different crew members saying 'Thank You' to their favorite teachers from the past. Wholesome community vibes."
    }
  ],
  "Current Event (Roofing)": [
    { 
      text: "Lumber prices are shifting. Here is what that means for your project cost.", 
      disc: "D",
      creative: "Reel: 'Breaking News' style. Green screen newsroom background. Presenter pointing to a graph of lumber prices. Professional and urgent tone."
    },
    { 
      text: "New Utah building codes for 2024: Are you compliant?", 
      disc: "C",
      creative: "Reel: Stop Motion. Stacking code books or paperwork. Text overlay: 'Don't let the red tape stop you. We know the codes.' Swipe transition to RHIVE logo."
    },
    { 
      text: "Tech in Roofing: How AI helps us quote faster than anyone else.", 
      disc: "D",
      creative: "Reel: Screen Recording. Show a sped-up view of the AI tool measuring a roof from satellite imagery. Timer in corner counting seconds: 'Quote in under 60s'."
    },
    { 
      text: "Storm Watch: High winds expected in Salt Lake Valley. Check your shingles!", 
      disc: "D",
      creative: "Reel: Windy Effect. Video of trees blowing wildly or wind noise audio. Cut to loose shingle flapping. Text: 'Secure your roof NOW'."
    },
    { 
      text: "Sustainable building trends: Why cool roofs are gaining popularity.", 
      disc: "C",
      creative: "Reel: Thermal Camera effect (or filter). Show a dark roof (red/hot) vs a cool roof (blue/cool). Visual proof of heat reflection."
    },
    { 
      text: "The rise of female leaders in the construction industry.", 
      disc: "S",
      creative: "Reel: Interview clip. Quick 15s soundbite from RHIVE leadership about why diversity matters in construction. Professional b-roll overlay."
    }
  ],
  "GAF Materials FAQ (Flat)": [
    { 
      text: "Why GAF TPO is the gold standard for Utah commercial buildings.", 
      disc: "D",
      creative: "Reel: Strength Test. Try to tear a piece of TPO by hand (fail). Try to poke it with a pen (fail). Show it's tough as nails."
    },
    { 
      text: "What is the lifespan of a GAF commercial flat roof system?", 
      disc: "C",
      creative: "Reel: Timeline Animation. Show a calendar flipping rapidly from 2025 to 2050+. Text overlay: 'Built for the long haul'."
    },
    { 
      text: "Energy efficiency ratings of GAF reflective membranes.", 
      disc: "C",
      creative: "Reel: Sun reflection. Hold a piece of white TPO in the sun, reflect light into camera lens (flare). Text: 'Reflects UV, Protects Budget'."
    },
    { 
      text: "Does GAF warranty cover ponding water? Let's dive into the fine print.", 
      disc: "C",
      creative: "Reel: Water Puddle. Show water sitting on a flat surface. Zoom in on the seam. Voiceover explaining the specific warranty clause simply."
    },
    { 
      text: "GAF EverGuardÂ® TPO: Why it resists dirt accumulation better.", 
      disc: "S",
      creative: "Reel: Cleaning Demo. Wipe a dirty section of TPO with a ragâ€”shows it cleans easily. Compare to a rougher surface that stays dirty."
    },
    { 
      text: "Certified Materials: Why using GAF certified contractors matters for warranty.", 
      disc: "S",
      creative: "Reel: Paperwork vs Trash. Holding a 'Certified Warranty' document (Gold filter) vs a generic piece of paper (crumple it up). 'Don't risk your coverage'."
    }
  ],
  "Owens Corning FAQ (Asphalt)": [
    { 
      text: "What makes Owens Corning DurationÂ® Shingles wind resistant?", 
      disc: "D",
      creative: "Reel: Leaf Blower Test. Set up a shingle on a stand. Blast it with a leaf blower. It doesn't move. Text: '130 MPH Wind Rating'."
    },
    { 
      text: "SureNailÂ® Technology: The difference you can't see but need.", 
      disc: "C",
      creative: "Reel: Macro Shot. Zoom in incredibly close to the nailing strip on the shingle. Point with a pen to the reinforced fabric area. 'This is the secret weapon'."
    },
    { 
      text: "Color of the Year: Exploring Owens Corning's aesthetic trends.", 
      disc: "I",
      creative: "Reel: Fashion Montage. Rapid cuts of the 'Color of the Year' shingle on different style houses. Upbeat, trendy fashion-show style music."
    },
    { 
      text: "How Owens Corning handles algae resistance (StreakGuardâ„¢).", 
      disc: "S",
      creative: "Reel: Split Screen. Left: Ugly streaked roof. Right: Clean Owens Corning roof. Slider moves across to reveal the clean version."
    },
    { 
      text: "The Total Protection Roofing SystemÂ®: It's more than just shingles.", 
      disc: "C",
      creative: "Reel: Layers. Show the deck, then leak barrier, then underlayment, then shingles being stacked like a sandwich. Text: 'It's a System, Not Just a Shingle'."
    },
    { 
      text: "Warranty transferability: Selling your home with an OC roof.", 
      disc: "D",
      creative: "Reel: Handshake. POV of handing over house keys to a new owner. Hand them a 'Warranty Folder' too. Text: 'Adds Value when you Sell'."
    }
  ],
  "GAF Trivia (Flat)": [
    { 
      text: "True or False: TPO roofing is 100% recyclable?", 
      disc: "I",
      creative: "Reel: 'Put a finger down'. Interactive quiz. 'Put a finger down if you think TPO is recyclable.' Pause. 'Yes it is!' Celebration confetti."
    },
    { 
      text: "Quiz: What does TPO actually stand for?", 
      disc: "C",
      creative: "Reel: Multiple Choice. Text boxes appear on screen: A) The Perfect Option B) Thermoplastic Polyolefin C) Tough Plastic Over. Tap the correct answer (B)."
    },
    { 
      text: "Trivia: What year was GAF founded? (Hint: It's been a while!)", 
      disc: "S",
      creative: "Reel: Historical B-roll. Black and white photos of old roofing transitioning to modern color photos. Text: 'Protecting homes since 1886'."
    },
    { 
      text: "Fact or Fiction: White flat roofs can reduce rooftop temps by 50Â°F.", 
      disc: "D",
      creative: "Reel: MythBusters style. Wearing safety glasses/lab coat. 'Let's test the temperature!' (Use stock footage of thermal tests)."
    },
    { 
      text: "Guess the thickness: Standard commercial TPO comes in 45, 60, or 80 mil?", 
      disc: "C",
      creative: "Reel: Comparison. Hold up 3 sheets of TPO with different thicknesses. Bend them to show flexibility vs rigidity."
    },
    { 
      text: "Which GAF product is best for restaurant roofs (grease resistance)?", 
      disc: "D",
      creative: "Reel: Cooking/Roofing mashup. Chef hat on. Flipping a burger, then cut to PVC roofing material. Text: 'Grease Resistant for Restaurants'."
    }
  ],
  "Owens Corning Trivia (Asphalt)": [
    { 
      text: "Trivia: Which famous cartoon character is the Owens Corning mascot?", 
      disc: "I",
      creative: "Reel: Pink Theme. Everything in the video is Pink. Pink shirt, pink hard hat (if avail), pink filter. Reveal the Pink Panther plushie at the end."
    },
    { 
      text: "Quiz: How many nails are used per shingle for high-wind warranties?", 
      disc: "C",
      creative: "Reel: Counting ASMR. Sound of nail gun: 'Pop, Pop, Pop, Pop'. Text counts up: 1, 2, 3, 4... 6! '6 Nails for Max Warranty'."
    },
    { 
      text: "True or False: Owens Corning invented fiberglass insulation?", 
      disc: "S",
      creative: "Reel: Nod or Shake. Text question appears above head. Person nods enthusiastically. 'Yes, they pioneered it!'"
    },
    { 
      text: "Speed Round: What is the wind speed rating for Duration shingles?", 
      disc: "D",
      creative: "Reel: Fan Test. Standing in front of a high power fan, hair blowing wild. Hold up sign: '130 MPH'."
    },
    { 
      text: "Name that color: What is the most popular shingle color in Utah?", 
      disc: "I",
      creative: "Reel: Color Palette. Show swatches of Driftwood, Onyx Black, Estate Gray. Ask followers to comment their vote. Reveal the winner in caption."
    },
    { 
      text: "History: When did Owens Corning introduce the fibreglass asphalt shingle?", 
      disc: "C",
      creative: "Reel: Throwback. 1970s disco music. Text overlay: 'The year was 1977...' Show retro house photo."
    }
  ],
  "RHIVE FAQ": [
    { 
      text: "Why don't we have sales reps? (Hint: It saves you money!)", 
      disc: "D",
      creative: "Reel: 'No Middle Man'. Visual of handing cash to a 'Sales Rep' who puts it in his pocket, vs handing cash directly to the 'Roof Material'. 'We cut the commission, you save cost'."
    },
    { 
      text: "What is our 'Lifetime No-Leak Guarantee'?", 
      disc: "S",
      creative: "Reel: Handshake contract. Firm handshake close up. Stamp 'GUARANTEED' sound effect and visual overlay. Serious, trustworthy eye contact."
    },
    { 
      text: "Do we offer financing? Yes, 0% for 18 months options available.", 
      disc: "D",
      creative: "Reel: Money Rain. (Use a filter). Relaxed posture. Text: 'Need a roof but short on cash? 0% Interest is here'."
    },
    { 
      text: "Woman-Owned: How we bring a different perspective to construction.", 
      disc: "S",
      creative: "Reel: Detail Oriented. Show typical construction site chaos vs RHIVE clean site. 'We care about the details, the cleanup, and the communication'."
    },
    { 
      text: "Remote Quotes: How we quote your roof without stepping foot on it.", 
      disc: "D",
      creative: "Reel: Satellite Zoom. Start with view of Earth, zoom in to USA, Utah, Salt Lake, Specific House. 'We quote from space. Fast & Contactless'."
    },
    { 
      text: "The RHIVE Difference: Certified Installers vs. 'Chuck in a truck'.", 
      disc: "S",
      creative: "Reel: Side by Side. Left: Guy in tank top with rusty truck (Chuck). Right: RHIVE pro in uniform with clean truck. 'Who do you trust with your biggest asset?'"
    }
  ]
};

const HOLIDAYS = {
  "01-01": "New Year's Day",
  "02-14": "Valentine's Day",
  "03-17": "St. Patrick's Day",
  "04-01": "April Fool's Day",
  "05-12": "Mother's Day",
  "05-27": "Memorial Day",
  "06-16": "Father's Day",
  "07-04": "Independence Day",
  "07-24": "Pioneer Day (Utah)",
  "09-02": "Labor Day",
  "10-31": "Halloween",
  "11-11": "Veterans Day",
  "11-28": "Thanksgiving",
  "12-25": "Christmas Day"
};

const generateCalendarData = () => {
  const data = [];
  const year = 2026; // Planning for next year
  const startDate = new Date(year, 0, 1);
  
  for (let i = 0; i < 365; i++) {
    const currentDate = new Date(startDate);
    currentDate.setDate(startDate.getDate() + i);
    
    const month = currentDate.getMonth();
    const dateString = `${String(month + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
    const dayOfWeek = currentDate.getDay(); // 0 = Sun, 6 = Sat
    
    let season = "Winter";
    if (SEASONS.Winter.months.includes(month)) season = "Winter";
    else if (SEASONS.Spring.months.includes(month)) season = "Spring";
    else if (SEASONS.Summer.months.includes(month)) season = "Summer";
    else season = "Fall";

    const isHoliday = HOLIDAYS[dateString];
    
    // Rotation Logic to ensure variety
    // Mon: Current Event/D, Tue: GAF/C, Wed: RHIVE FAQ/S, Thu: OC/C, Fri: Meme/I, Sat: Community/I, Sun: Education/S
    let topicIndex = i % TOPICS.length;
    let topic = TOPICS[topicIndex];
    
    // Override logic for flow
    if (dayOfWeek === 1) topic = "Current Event (Roofing)"; // Monday business
    if (dayOfWeek === 5) topic = "Relatable Meme"; // Friday fun
    if (dayOfWeek === 6) topic = "Community Engagement"; // Saturday community
    if (dayOfWeek === 0) topic = "Educational Post"; // Sunday reading
    
    // Rotate materials mid-week
    if (dayOfWeek === 2) topic = (i % 2 === 0) ? "GAF Materials FAQ (Flat)" : "GAF Trivia (Flat)";
    if (dayOfWeek === 3) topic = "RHIVE FAQ";
    if (dayOfWeek === 4) topic = (i % 2 === 0) ? "Owens Corning FAQ (Asphalt)" : "Owens Corning Trivia (Asphalt)";

    if (isHoliday) {
      topic = "Community Engagement";
    }

    // Pick content from library
    const lib = CONTENT_LIBRARY[topic];
    let contentItem = lib[i % lib.length];
    
    // Custom Holiday Override
    if (isHoliday) {
      contentItem = { 
        text: `Happy ${isHoliday}! Wishing our Utah community a safe and happy holiday.`, 
        disc: "I",
        creative: `Reel: Holiday Greeting. Team waving with ${isHoliday} props (e.g. Santa Hats, Flags). Overlay text: 'From our RHIVE family to yours'.`
      };
    }

    data.push({
      id: i,
      date: currentDate,
      formattedDate: currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
      dayOfWeek: currentDate.toLocaleDateString('en-US', { weekday: 'short' }),
      topic: topic,
      content: contentItem.text,
      creative: contentItem.creative,
      disc: contentItem.disc,
      season: season,
      isHoliday: !!isHoliday
    });
  }
  return data;
};

const ContentCalendar = () => {
  const [calendarData, setCalendarData] = useState([]);
  const [view, setView] = useState('calendar'); // 'calendar', 'list', 'engagement'
  const [currentMonth, setCurrentMonth] = useState(0);
  const [selectedDisc, setSelectedDisc] = useState('All');
  const [selectedTopic, setSelectedTopic] = useState('All');
  const [searchTerm, setSearchTerm] = useState('');

  useEffect(() => {
    setCalendarData(generateCalendarData());
  }, []);

  const filteredData = useMemo(() => {
    return calendarData.filter(item => {
      const matchMonth = item.date.getMonth() === currentMonth;
      const matchDisc = selectedDisc === 'All' || item.disc === selectedDisc;
      const matchTopic = selectedTopic === 'All' || item.topic === selectedTopic;
      const matchSearch = item.content.toLowerCase().includes(searchTerm.toLowerCase()) || 
                          item.topic.toLowerCase().includes(searchTerm.toLowerCase()) ||
                          item.creative.toLowerCase().includes(searchTerm.toLowerCase());
      
      if (view === 'calendar') return matchMonth && matchDisc && matchTopic && matchSearch;
      return matchDisc && matchTopic && matchSearch;
    });
  }, [calendarData, currentMonth, selectedDisc, selectedTopic, searchTerm, view]);

  const nextMonth = () => setCurrentMonth(prev => (prev + 1) % 12);
  const prevMonth = () => setCurrentMonth(prev => (prev - 1 + 12) % 12);

  const getDiscColor = (code) => DISC_TYPES[code] ? DISC_TYPES[code].color : "bg-gray-100 text-gray-800";
  const getDiscIcon = (code) => DISC_TYPES[code] ? DISC_TYPES[code].icon : Activity;

  // Engagement View Component
  const EngagementView = () => (
    <div className="space-y-8">
      {/* 1. Daily Checklist */}
      <section>
        <h2 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
          <CheckCircle className="text-green-500" /> Daily Engagement Routine (Mon-Fri)
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {ENGAGEMENT_STRATEGY.dailyRoutine.map((task, idx) => {
            const Icon = task.icon;
            return (
              <div key={idx} className="bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex items-center gap-4">
                <div className={`p-4 rounded-full bg-slate-50 ${task.color}`}>
                  <Icon className="w-8 h-8" />
                </div>
                <div>
                  <div className="text-3xl font-bold text-slate-800">{task.count}</div>
                  <div className="text-sm font-semibold text-slate-600 uppercase tracking-wide">{task.action}</div>
                  <div className="text-xs text-slate-400 mt-1">Target: {task.target}</div>
                </div>
              </div>
            );
          })}
        </div>
      </section>

      {/* 2. Target Accounts */}
      <section>
        <h2 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
          <Target className="text-[#EC028B]" /> Target Accounts in Utah
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          {ENGAGEMENT_STRATEGY.targetAccounts.map((target, idx) => (
            <div key={idx} className="bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition">
              <h3 className="font-bold text-lg text-slate-700 mb-1">{target.category}</h3>
              <p className="text-sm text-slate-500 mb-3">{target.description}</p>
              
              <div className="bg-slate-50 p-3 rounded-lg mb-3">
                <span className="text-xs font-bold text-slate-400 uppercase">Examples to Follow:</span>
                <div className="flex flex-wrap gap-2 mt-1">
                  {target.examples.map((ex, i) => (
                    <span key={i} className="text-xs bg-white border border-gray-200 px-2 py-1 rounded-md text-slate-600 font-mono">
                      {ex}
                    </span>
                  ))}
                </div>
              </div>
              
              <div className="flex items-center gap-2 text-xs text-green-600 font-medium">
                <Zap className="w-3 h-3" /> Goal: {target.goal}
              </div>
            </div>
          ))}
        </div>
      </section>

      {/* 3. Comment Bank */}
      <section>
        <h2 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
          <MessageCircle className="text-blue-500" /> Quick-Reply Comment Bank
        </h2>
        <div className="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden">
          <table className="w-full text-left text-sm">
            <thead className="bg-slate-50 text-slate-500 border-b">
              <tr>
                <th className="p-4 font-semibold">Scenario</th>
                <th className="p-4 font-semibold">Suggested Comment</th>
                <th className="p-4 font-semibold">Tone</th>
                <th className="p-4 font-semibold w-20">Action</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-100">
              {ENGAGEMENT_STRATEGY.commentBank.map((comment, idx) => (
                <tr key={idx} className="hover:bg-slate-50 transition">
                  <td className="p-4 font-medium text-slate-700">{comment.label}</td>
                  <td className="p-4 text-slate-600 italic">"{comment.text}"</td>
                  <td className="p-4">
                    <span className="inline-block px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full font-medium">
                      {comment.tone}
                    </span>
                  </td>
                  <td className="p-4">
                    <button 
                      className="p-2 hover:bg-blue-50 text-blue-500 rounded-lg transition"
                      title="Copy to Clipboard"
                      onClick={() => navigator.clipboard.writeText(comment.text)}
                    >
                      <Copy className="w-4 h-4" />
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </section>
    </div>
  );

  return (
    <div className="min-h-screen bg-gray-50 text-slate-800 font-sans">
      {/* Header */}
      <header className="bg-black text-white p-6 shadow-lg border-b-4 border-[#EC028B]">
        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
          <div>
            <h1 className="text-3xl font-bold flex items-center gap-2">
              <Shield className="text-[#EC028B]" /> RHIVE Construction
            </h1>
            <p className="text-slate-400 mt-1">365-Day AI-Driven Content Calendar (Utah Edition)</p>
          </div>
          <div className="flex gap-2 mt-4 md:mt-0 bg-gray-900 p-1 rounded-lg">
            <button 
              onClick={() => setView('calendar')} 
              className={`px-4 py-2 rounded-md font-medium text-sm transition ${view === 'calendar' ? 'bg-[#EC028B] text-white shadow-[0_0_10px_#EC028B]' : 'text-slate-300 hover:text-white hover:border-[#EC028B] border border-transparent'}`}
            >
              Calendar
            </button>
            <button 
              onClick={() => setView('list')} 
              className={`px-4 py-2 rounded-md font-medium text-sm transition ${view === 'list' ? 'bg-[#EC028B] text-white shadow-[0_0_10px_#EC028B]' : 'text-slate-300 hover:text-white hover:border-[#EC028B] border border-transparent'}`}
            >
              List View
            </button>
            <button 
              onClick={() => setView('engagement')} 
              className={`px-4 py-2 rounded-md font-medium text-sm transition flex items-center gap-2 ${view === 'engagement' ? 'bg-[#EC028B] text-white shadow-[0_0_10px_#EC028B]' : 'text-slate-300 hover:text-white hover:border-[#EC028B] border border-transparent'}`}
            >
              <Users className="w-4 h-4" /> Engagement
            </button>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto p-6">
        
        {view !== 'engagement' && (
          /* Controls - Only show on Calendar/List views */
          <div className="bg-white p-4 rounded-xl shadow-sm mb-6 flex flex-col lg:flex-row gap-4 items-center justify-between border border-gray-100">
            {/* Month Nav */}
            {view === 'calendar' && (
              <div className="flex items-center gap-4">
                <button onClick={prevMonth} className="p-2 hover:bg-gray-100 rounded-full"><ChevronLeft /></button>
                <h2 className="text-xl font-bold w-48 text-center">
                  {new Date(2026, currentMonth).toLocaleString('default', { month: 'long', year: 'numeric' })}
                </h2>
                <button onClick={nextMonth} className="p-2 hover:bg-gray-100 rounded-full"><ChevronRight /></button>
              </div>
            )}

            {/* Filters */}
            <div className="flex flex-wrap gap-3 items-center w-full lg:w-auto ml-auto">
              <div className="relative">
                <Search className="absolute left-3 top-2.5 h-4 w-4 text-gray-400" />
                <input 
                  type="text" 
                  placeholder="Search content..." 
                  className="pl-9 pr-4 py-2 border rounded-lg text-sm w-full md:w-64 focus:ring-2 focus:ring-[#EC028B] outline-none"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                />
              </div>

              <select 
                className="px-3 py-2 border rounded-lg text-sm bg-white"
                value={selectedDisc}
                onChange={(e) => setSelectedDisc(e.target.value)}
              >
                <option value="All">All Personalities</option>
                <option value="D">Dominance (Results)</option>
                <option value="I">Influence (Social)</option>
                <option value="S">Steadiness (Trust)</option>
                <option value="C">Conscientiousness (Facts)</option>
              </select>

              <select 
                className="px-3 py-2 border rounded-lg text-sm bg-white"
                value={selectedTopic}
                onChange={(e) => setSelectedTopic(e.target.value)}
              >
                <option value="All">All Topics</option>
                {TOPICS.map(t => <option key={t} value={t}>{t}</option>)}
              </select>

              <button className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium">
                <Download className="h-4 w-4" /> Export
              </button>
            </div>
          </div>
        )}

        {view !== 'engagement' && (
            /* Legend */
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            {Object.entries(DISC_TYPES).map(([key, info]) => {
                const Icon = info.icon;
                return (
                <div key={key} className={`p-3 rounded-lg border ${info.color.replace('text', 'border').replace('800', '200')} bg-opacity-50 flex items-start gap-3`}>
                    <div className={`p-2 rounded-full bg-white shadow-sm`}>
                    <Icon className="h-5 w-5" />
                    </div>
                    <div>
                    <div className="font-bold text-sm">{info.label} ({key})</div>
                    <div className="text-xs opacity-80 leading-tight mt-1">{info.desc}</div>
                    </div>
                </div>
                );
            })}
            </div>
        )}

        {/* VIEW: Engagement Strategy */}
        {view === 'engagement' && <EngagementView />}

        {/* VIEW: Calendar Grid */}
        {view === 'calendar' && (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            {filteredData.map((item) => {
               const DiscIcon = getDiscIcon(item.disc);
               return (
                <div key={item.id} className="bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition duration-200 flex flex-col overflow-hidden">
                  <div className="p-4 flex-grow">
                    <div className="flex justify-between items-start mb-3">
                      <div className="flex items-center gap-2">
                        <span className="font-bold text-lg text-slate-700">{item.formattedDate}</span>
                        <span className="text-xs text-gray-500 uppercase font-semibold">{item.dayOfWeek}</span>
                      </div>
                      {item.isHoliday && <span className="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full font-bold">Holiday</span>}
                    </div>
                    
                    <div className="mb-2">
                      <span className="inline-block px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-md font-medium mb-2">
                        {item.topic}
                      </span>
                    </div>

                    <p className="text-slate-800 text-sm leading-relaxed font-medium mb-3">
                      "{item.content}"
                    </p>

                    <div className="bg-slate-50 p-2 rounded-lg border border-slate-100 text-xs text-slate-600">
                        <div className="flex items-center gap-1 mb-1 font-bold text-slate-800">
                             <Video className="w-3 h-3" /> Creative Concept
                        </div>
                        {item.creative}
                    </div>
                  </div>

                  <div className={`px-4 py-3 mt-auto flex items-center justify-between ${getDiscColor(item.disc)}`}>
                    <div className="flex items-center gap-2">
                      <DiscIcon className="h-4 w-4" />
                      <span className="text-xs font-bold uppercase tracking-wider">Type {item.disc} Target</span>
                    </div>
                    {item.season === 'Winter' && <CloudSnow className="h-4 w-4 opacity-50" />}
                    {item.season === 'Spring' && <CloudRain className="h-4 w-4 opacity-50" />}
                    {item.season === 'Summer' && <Sun className="h-4 w-4 opacity-50" />}
                    {item.season === 'Fall' && <Leaf className="h-4 w-4 opacity-50" />}
                  </div>
                </div>
               );
            })}
            
            {filteredData.length === 0 && (
              <div className="col-span-full py-20 text-center text-gray-400">
                <Info className="h-12 w-12 mx-auto mb-4 opacity-50" />
                <p>No content found for the selected filters.</p>
              </div>
            )}
          </div>
        )}

        {/* VIEW: List */}
        {view === 'list' && (
          <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full text-left text-sm">
                <thead className="bg-gray-50 text-gray-500 border-b">
                  <tr>
                    <th className="p-4 font-semibold">Date</th>
                    <th className="p-4 font-semibold">DISC</th>
                    <th className="p-4 font-semibold">Topic</th>
                    <th className="p-4 font-semibold">Caption/Text</th>
                    <th className="p-4 font-semibold bg-blue-50">Creative Concept (Reel/Video)</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-100">
                  {filteredData.map(item => (
                    <tr key={item.id} className="hover:bg-slate-50 transition">
                      <td className="p-4 whitespace-nowrap font-medium text-slate-700">
                        {item.formattedDate}
                        {item.isHoliday && <span className="ml-2 text-xs text-purple-600 font-bold">(Holiday)</span>}
                      </td>
                      <td className="p-4">
                        <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-md text-xs font-bold ${getDiscColor(item.disc)}`}>
                          {item.disc}
                        </span>
                      </td>
                      <td className="p-4 text-slate-600">{item.topic}</td>
                      <td className="p-4 text-slate-800 max-w-xs">{item.content}</td>
                      <td className="p-4 text-slate-700 bg-blue-50 max-w-xs font-medium border-l border-blue-100">
                        <div className="flex items-start gap-2">
                             <Video className="w-4 h-4 mt-0.5 text-blue-500 flex-shrink-0" />
                             {item.creative}
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            {filteredData.length === 0 && (
               <div className="p-10 text-center text-gray-400">No results found.</div>
            )}
          </div>
        )}
      </main>
    </div>
  );
};

export default ContentCalendar;